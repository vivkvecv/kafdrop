name: kafdrop
on:
  push:
    branches:
    - 'deploy/uat'
    paths:
    - '.github/workflows/test.yaml'
jobs:
  if_merged:
    runs-on: self-hosted 
    steps:
    - name: Install SSH key
      uses: shimataro/ssh-key-action@v2
      with:
        key: ${{ secrets.SSH_QA_PRIVATE_KEY }} 
        known_hosts: 'just-a-placeholder-so-we-dont-get-errors'
        if_key_exists: ignore
    - name: Adding Known Hosts
      run: ssh-keyscan -H ${{ secrets.SSH_QA_HOST }} >> ~/.ssh/known_hosts
    - name: Setup Maven
  # You may pin to the exact commit or the version.
  # uses: stCarolas/setup-maven@417e1a9899611c0350621d1fb0c2770f35105c69vecv-streamer-0.0.1-SNAPSHOT.jar
      uses: stCarolas/setup-maven@v4.4
      with:
    # Version Spec of the version to use.  Examples: 10.x, 10.15.1, >=10.15.0....
        maven-version: 3.8.2
    - name: Build
      uses: actions/checkout@v3
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven
    - name: Build with Maven and push to vm
      run: mvn clean package -file kafdrop/pom.xml
    - name: print
      run: |
        mvn assembly:single docker:build
